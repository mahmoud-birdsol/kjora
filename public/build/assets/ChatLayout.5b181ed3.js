import{V as L,r as x,j as B,o as n,c as p,w as g,a as e,n as y,d as l,F as E,g as j,b as v,t as h,e as m,u as w,I as V,s as S,C as F,_ as N,m as b,aB as T,y as z,P as A}from"./app.8ff0f107.js";import{d as C}from"./dayjs.min.61a7718e.js";import{_ as k}from"./DateTranslation.68228c64.js";import{_ as D}from"./Avatar.vue_vue_type_style_index_0_lang.13aa623b.js";import{_ as G}from"./ConfirmationModal.2d697eda.js";import{F as M}from"./ResponsiveNavLink.118cd62e.js";import{r as I}from"./AppLayout.ac3aab9c.js";import{r as O}from"./TrashIcon.e2d94f9f.js";import{_ as P}from"./TextInput.42ee8067.js";const U={class:"flex flex-row items-center w-full gap-4"},q={class:"flex flex-col gap-1 max-sm:flex-1"},H={class:"m-0 text-lg leading-none text-white capitalize"},J={class:"text-xs leading-none text-neutral-400 rtl:before:content-['a'] rtl:before:text-transparent"},K={key:0,class:"flex gap-1 sm:hidden"},Q={class:"text-xs text-gray-300"},R={class:"flex gap-2 -mt-2 mis-auto"},W={key:0,class:"max-sm:hidden"},X={class:"text-xs text-gray-300 max-sm:scale-75"},Y={key:1,class:"flex items-center text-xs text-white rtl:flex-row-reverse"},Z={class:"flex w-full gap-6"},ee={class:"text-sm text-white truncate max-w-[30ch]"},te={key:0,class:"absolute p-1 ltr:right-1 top-1 rtl:left-1"},se={class:"grid w-6 h-6 p-1 text-xs bg-white rounded-full place-items-center"},oe={__name:"ConversationCard",props:{conversation:Object},setup(o){const i=L("conversation"),a=x(!1),t=x(!0),s=o,r=B(()=>i&&i.id===s.conversation.id);function c(){F.delete(route("chats.delete",s.conversation.id),{preserveScroll:!0,preserveState:!1}),a.value=!1}return(u,f)=>(n(),p(w(S),{href:u.route("chats.show",o.conversation.id),class:y(r.value?"border-2 border-primary rounded-2xl":"")},{default:g(()=>{var $;return[e("div",{onClick:f[2]||(f[2]=d=>t.value=!1),style:{"background-image":"url('/images/chatbg.png')"},class:y(["bg-cover relative rounded-2xl p-6 flex flex-col gap-8 items-start bg-[center_center]",r.value?"border-2 border-white":""])},[(n(!0),l(E,null,j(o.conversation.users,d=>(n(),l("div",U,[e("div",null,[v(D,{id:d.id,"image-url":d.avatar_url,size:"lg",username:d.name,border:!0},null,8,["id","image-url","username"])]),e("div",q,[e("h4",H,h(d.name),1),e("span",J," @"+h(d.username),1),d.online?m("",!0):(n(),l("div",K,[e("p",Q,[o.conversation.latest_message?(n(),p(k,{key:0,end:o.conversation.latest_message.created_at,type:"period"},null,8,["end"])):m("",!0)])]))]),e("div",R,[d.online?(n(),l("p",Y,[v(w(I),{class:"inline w-3 h-3 mr-1 text-green-500"}),f[3]||(f[3]=e("span",null,"Online",-1))])):(n(),l("div",W,[e("p",X,[o.conversation.latest_message?(n(),p(k,{key:0,end:o.conversation.latest_message.created_at,type:"period"},null,8,["end"])):m("",!0)])]))])]))),256)),e("div",Z,[e("p",ee,h(($=o.conversation.latest_message)==null?void 0:$.body),1),e("button",{onClick:f[0]||(f[0]=V(d=>a.value=!0,["stop","prevent"])),class:"self-end mis-auto"},[v(w(O),{class:"w-5 text-stone-200 hover:text-red-600 active:scale-90"})]),v(G,{show:a.value,onClose:f[1]||(f[1]=d=>a.value=!1),onDelete:c},{body:g(()=>[e("span",null,h(u.$t("Are you sure you want delete this Conversation ? ")),1)]),_:1},8,["show"])]),v(M,null,{default:g(()=>[o.conversation.unread_messages!==0&&t.value?(n(),l("div",te,[e("span",se,h(o.conversation.unread_messages),1)])):m("",!0)]),_:1})],2)]}),_:1},8,["href","class"]))}};const ne={};function ae(o,i){return n(),p(T,{name:"list"},{default:g(()=>[b(o.$slots,"default")]),_:3})}const re=N(ne,[["render",ae]]),le={class:"flex flex-col h-full gap-4"},ie={class:"flex"},ce={class:"flex-grow"},de={class:"mb-3 font-bold text-black uppercase"},ue={ref:"conversationList",class:"flex self-end hideScrollBar flex-col gap-3 h-full max-h-[500px] overflow-auto"},fe={__name:"ConversationsList",props:{conversations:Array},setup(o){const i=o,a=x(i.conversations),t=x("");z(t,()=>_.debounce(s,300)());function s(){a.value=i.conversations.filter(r=>{let c=!1;return r.users.forEach(u=>{u.name.toLowerCase().includes(t.value.toLowerCase())&&(c=!0)}),c})}return(r,c)=>(n(),l("div",le,[e("div",ie,[v(P,{type:"search",modelValue:t.value,"onUpdate:modelValue":c[0]||(c[0]=u=>t.value=u),placeholder:r.$t("search")},null,8,["modelValue","placeholder"])]),e("div",ce,[e("p",de,h(r.$t("total ( :count )",{count:a.value.length})),1),e("div",ue,[v(re,null,{default:g(()=>[(n(!0),l(E,null,j(a.value,u=>(n(),p(oe,{key:u.id,conversation:u},null,8,["conversation"]))),128))]),_:1})],512)])]))}},ve={class:"py-12"},me={class:"relative grid h-full w-full max-w-full overflow-hidden min-h-[500px] rounded-2xl bg-white text-neutral-500 lg:grid-cols-[1.2fr_2fr]"},he={class:"flex-col w-full h-full gap-3 px-6 py-3 max-lg:border-b max-lg:border-b-stone-400 lg:flex ltr:lg:border-r ltr:lg:border-r-stone-400 rtl:lg:border-l rtl:lg:border-l-stone-400"},_e={class:""},pe={class:"grid h-full grid-flow-row"},ge={key:0,class:"flex self-start border-b border-b-stone-400 min-h-[1rem]"},xe={key:1,class:"self-stretch p-4 contain"},be={key:2,class:"self-end py-2 border-t h-min border-t-stone-400"},we={class:"border-t-stone-400 border-t p-1"},Se={__name:"ChatLayout",props:{conversations:{required:!0,type:Array}},setup(o){const i=o;x(!1),i.conversations.forEach(t=>{Echo.join("chat."+t.id).here(function(s){s.forEach(r=>{a(r,!0)})}).joining(function(s){a(s,!0)}).leaving(function(s){a(s,!1),s.last_seen_at=C()}),Echo.join("presence-chat."+t.id).here(function(s){s.forEach(r=>{a(r,!0)})}).joining(function(s){a(s,!0)}).leaving(function(s){a(s,!1),s.last_seen_at=C()})});const a=(t,s)=>{i.conversations.forEach(r=>{r.users.forEach(c=>{c.id===t.id&&(c.online=s)})})};return A(()=>{i.conversations.forEach(t=>{Echo.leave("chat."+t.id),axios.post(route("api.user.left"))})}),(t,s)=>(n(),l("div",ve,[e("div",me,[e("div",he,[e("div",_e,[v(fe,{conversations:o.conversations},null,8,["conversations"])])]),e("div",pe,[t.$slots.header?(n(),l("div",ge,[b(t.$slots,"header")])):m("",!0),t.$slots.main?(n(),l("div",xe,[b(t.$slots,"main")])):m("",!0),t.$slots.footer?(n(),l("div",be,[e("div",we,[b(t.$slots,"footer")])])):m("",!0)])])]))}};export{Se as _};
