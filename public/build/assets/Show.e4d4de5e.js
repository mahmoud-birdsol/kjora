import{_ as be}from"./AppLayout.ac3aab9c.js";import{_ as we}from"./ChatLayout.5b181ed3.js";import"./base.1b1bd1ad.js";import{v as re}from"./loading.0484db5f.js";import{o as a,d as l,a as t,_ as ee,t as b,e as p,aC as _e,B as I,r as $,h as ie,c as T,w as x,b as r,u as s,s as X,f as q,l as $e,q as L,v as H,F as N,g as F,n as U,Q as oe,aD as z,k as ve,p as ae,m as ke,j as Me,i as Ce,y as je,I as P,K as Te,T as Se,a5 as We,a3 as Ne,E as Pe}from"./app.8ff0f107.js";import{d as ye}from"./dayjs.min.61a7718e.js";import{S as de,a as Be,b as ce}from"./vue-splide.esm.8f184fc8.js";import{_ as xe}from"./Modal.b3ff11aa.js";import{_ as te,N as Ue}from"./Avatar.vue_vue_type_style_index_0_lang.13aa623b.js";import{_ as D,a as ue}from"./DateTranslation.68228c64.js";import{r as V}from"./XMarkIcon.4621726c.js";import{_ as Oe}from"./ConfirmationModal.2d697eda.js";import{F as ne}from"./ResponsiveNavLink.118cd62e.js";import{r as Le}from"./TrashIcon.e2d94f9f.js";import{_ as qe,r as Fe}from"./ReportModal.78ea62a4.js";import{_ as ze}from"./TextInput.42ee8067.js";import{r as Ie}from"./MagnifyingGlassIcon.14abb4a5.js";import{_ as De}from"./PrimaryButton.11a51cad.js";import{_ as Ae}from"./CropIcon.7fde5f5f.js";import{C as Re}from"./Crop.ae2eb42b.js";import{r as Ee}from"./PlusCircleIcon.76342808.js";import{r as Ye,E as Ve,a as He}from"./EmojiPickerElement.366cc66a.js";import"./StarIcon.5dbdfceb.js";import"./MapPinIcon.afa94ea1.js";import"./SecondaryButton.5221202e.js";import"./InvitationPlayerCard.1c9614ad.js";import"./index.1938c188.js";import"./CheckIcon.7c9aeea7.js";/* empty css                                                  */import"./index.412eb292.js";import"./radio-group.451bf289.js";import"./index.f405b57e.js";/* empty css                                                                           */function Ge(e,n){return a(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m9 12.75 3 3m0 0 3-3m-3 3v-7.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})])}function Ze(e,n){return a(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"})])}function Ke(e,n){return a(),l("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"fill-rule":"evenodd",d:"M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25Zm.53 5.47a.75.75 0 0 0-1.06 0l-3 3a.75.75 0 1 0 1.06 1.06l1.72-1.72v5.69a.75.75 0 0 0 1.5 0v-5.69l1.72 1.72a.75.75 0 1 0 1.06-1.06l-3-3Z","clip-rule":"evenodd"})])}function Qe(e,n){return a(),l("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"fill-rule":"evenodd",d:"M1.5 6a2.25 2.25 0 0 1 2.25-2.25h16.5A2.25 2.25 0 0 1 22.5 6v12a2.25 2.25 0 0 1-2.25 2.25H3.75A2.25 2.25 0 0 1 1.5 18V6ZM3 16.06V18c0 .414.336.75.75.75h16.5A.75.75 0 0 0 21 18v-1.94l-2.69-2.689a1.5 1.5 0 0 0-2.12 0l-.88.879.97.97a.75.75 0 1 1-1.06 1.06l-5.16-5.159a1.5 1.5 0 0 0-2.12 0L3 16.061Zm10.125-7.81a1.125 1.125 0 1 1 2.25 0 1.125 1.125 0 0 1-2.25 0Z","clip-rule":"evenodd"})])}function Je(e,n){return a(),l("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{d:"M10 3a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM10 8.5a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM11.5 15.5a1.5 1.5 0 1 0-3 0 1.5 1.5 0 0 0 3 0Z"})])}const Xe={},et={class:"w-6 h-4 rtl:-scale-x-100",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 510 510","stroke-width":"30"};function tt(e,n){return a(),l("svg",et,n[0]||(n[0]=[t("path",{d:"M205 34.8c11.5 5.1 19 16.6 19 29.2v64H336c97.2 0 176 78.8 176 176c0 113.3-81.5 163.9-100.2 174.1c-2.5 1.4-5.3 1.9-8.1 1.9c-10.9 0-19.7-8.9-19.7-19.7c0-7.5 4.3-14.4 9.8-19.5c9.4-8.8 22.2-26.4 22.2-56.7c0-53-43-96-96-96H224v64c0 12.6-7.4 24.1-19 29.2s-25 3-34.4-5.4l-160-144C3.9 225.7 0 217.1 0 208s3.9-17.7 10.6-23.8l160-144c9.4-8.5 22.9-10.6 34.4-5.4z"},null,-1)]))}const me=ee(Xe,[["render",tt]]),st=["src"],at={key:1,class:"object-cover overflow-hidden rounded-lg aspect-video"},lt=["src"],rt={key:2,class:""},it={class:"truncate"},ot={key:3,class:""},nt={class:"break-words truncate"},le={__name:"MediaPreview",props:{fileType:String,filePreview:String,fileName:String},setup(e){return(n,i)=>e.fileType.startsWith("image")?(a(),l("img",{key:0,class:"object-cover object-center w-full h-32 rounded-lg",src:e.filePreview},null,8,st)):e.fileType.startsWith("video")?(a(),l("div",at,[t("video",{src:e.filePreview,class:"w-full h-full"},null,8,lt)])):e.fileType.endsWith(".document")||e.fileType.startsWith("application/msword")?(a(),l("div",rt,[i[0]||(i[0]=t("img",{class:"object-contain w-5 mx-auto h-7",src:"/images/doc.png"},null,-1)),t("p",it,b(e.fileName),1)])):e.fileType.startsWith("application/pdf")?(a(),l("div",ot,[i[1]||(i[1]=t("img",{class:"object-contain mx-auto w-7 h-7",src:"/images/pdf.png"},null,-1)),t("p",nt,b(e.fileName),1)])):p("",!0)}},se=_e("chat",{state(){return{messages:[],page:1,lastPage:0,showLastPageNotice:!1,loading:!1,container:null,conversation:null,search:"",replyToMessage:null,currentUserId:null,interval:null}},getters:{messageList(e){return e.messages},lastPageReached(e){return e.page===e.lastPage},isLoading(e){return e.loading},repliedMessage(e){return e.replyToMessage}},actions:{initialize({conversation:e,container:n,currentUserId:i}){this.conversation=e,this.container=n,this.currentUserId=i,this.subscribeToConversation(),this.messages=[],this.fetchMessages(),this.interval=setInterval(this.fetchNewMessages,3e4),setTimeout(()=>{this.registerScrollListener()},3e3)},subscribeToConversation(){Echo.private(`users.chat.${this.conversation.id}`).listen(".message-sent",e=>{this.currentUserId!==e.sender_id&&(this.messages.unshift({...e,new:!0}),this.scrollToMessagesBottom(),I.post(route("api.message.mark-as-read",e.id)))}).listen(".message-read",e=>{this.setMessageAsRead(e)})},async fetchMessages(){this.loading=!0;try{let e=await I.get(route("api.messages.index",this.conversation),{params:{page:this.page,search:this.search}});this.messages=this.messages.concat(e.data.data),this.lastPage=e.data.meta.last_page,this.loading=!1,this.messages.forEach(n=>{n.read_at==null&&n.sender_id!==this.currentUserId&&I.post(route("api.message.mark-as-read",n.id))}),this.page===1&&this.scrollToMessagesBottom()}catch(e){return this.loading=!1,e}},async fetchNewMessages(){try{(await I.get(route("api.messages.new",this.conversation))).data.data.forEach(i=>{this.messages.some(o=>o.id===i.id)||(this.messages.unshift({...i,new:!0}),this.scrollToMessagesBottom())})}catch(e){return this.loading=!1,e}},async searchMessages(){console.log("searchMessages"),this.page=1,this.messages=[],await this.fetchMessages()},deleteMessage(e){let n=this.messages.findIndex(i=>i.id===e);this.messages.splice(n,1)},setMessageAsRead(e){let n=this.messages.findIndex(i=>i.id===e.id);this.messages[n].read_at=e.read_at},registerScrollListener(){this.container&&this.container.addEventListener("scroll",this.handleScroll)},unRegisterScrollListener(){this.container&&this.container.removeEventListener("scroll",this.handleScroll)},UnsubscribeFromChatChannel(){Echo.leave(`users.chat.${this.conversation.id}`)},clearFetchNewMessages(){clearInterval(this.interval)},setMessageToReplyTo(e){this.replyToMessage=e},pushNewMessage(e){this.messages.unshift(e),this.scrollToMessagesBottom(),this.replyToMessage=null},scrollToMessagesBottom(){let e=this;setTimeout(()=>{e.container.scrollTo({top:e.container.scrollHeight,left:0,behavior:"smooth"})},200)},scrollToMessagesTop(){let e=this;setTimeout(()=>{e.container.scrollTo({top:0,left:0,behavior:"smooth"})},200)},handleScroll(e){let n=e.target;if(this.lastPageReached){this.showLastPageNotice=!0;return}n.scrollTop===0&&(this.page++,this.fetchMessages())}}}),dt={},ct={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 512"};function ut(e,n){return a(),l("svg",ct,n[0]||(n[0]=[t("path",{fill:"#FFF",d:"M246.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L178.7 256 41.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"},null,-1)]))}const he=ee(dt,[["render",ut]]);const mt={class:"max-w-full py-5 bg-white px-7"},ht={class:"flex items-center justify-between"},ft={class:"flex items-center gap-2"},pt={class:"text-primary"},gt={class:"text-xs text-gray-400"},vt={class:"flex gap-2"},yt=["href","download"],xt={class:"my-4"},bt={class:"splide__arrows"},wt={class:"splide__arrow splide__arrow--prev",style:{"background-color":"black !important",opacity:"1"},"aria-label":"Next slide","aria-controls":"splide01-track"},_t={class:"splide__arrow splide__arrow--next",style:{"background-color":"black !important",opacity:"1"},"aria-label":"Previous slide","aria-controls":"splide01-track"},$t=["src"],kt=["src"],Mt={class:"","some-slider":""},Ct=["src"],jt=["src"],Tt={__name:"MediaGallery",props:{show:{type:Boolean,default:!1},maxWidth:{type:String,default:"6xl"},closeable:{type:Boolean,default:!0},position:{required:!1,type:String,default:"center"},media:{required:!0,type:Array},user:Object},emits:["close"],setup(e,{emit:n}){const i=e,o=$(),m=$();let g=$(!1);const v=$(i.media[0].original_url),c=$(i.media[0].file_name),C={arrows:i.media.length>1,type:i.media.length>1?"loop":"slide",perPage:1,perMove:1,gap:"1rem",pagination:!1,fixedHeight:"50vh"},y={type:"slide",rewind:!0,gap:"1rem",pagination:!1,fixedHeight:150,autoWidth:!0,drag:"free",snap:!0,isNavigation:!0,updateOnMove:!0,arrows:!1,perPage:i.media.length>5?5:i.media.length,width:"100%",breakpoints:{640:{perPage:3,width:i.media.length>5?"100%":"70%"}}};ie(()=>{var f,d;const h=(f=m.value)==null?void 0:f.splide;h&&((d=o.value)==null||d.sync(h))});function S(h){v.value=i.media[h.index].original_url,c.value=`Kjora-${ye().format("YYYY-MM-DD-HH-mm-ss")}`}return(h,f)=>(a(),T(xe,{show:e.show,"max-width":e.maxWidth,closeable:e.closeable,position:e.position,onClose:f[2]||(f[2]=d=>h.$emit("close")),"show-close-icon":!1},{default:x(()=>[t("div",mt,[t("div",ht,[t("div",ft,[r(te,{id:e.user.id,"image-url":e.user.avatar_url,size:"md",username:e.user.name,border:!0},null,8,["id","image-url","username"]),t("div",null,[t("div",pt,b(e.user.name),1),r(s(X),{class:"text-xs text-gray-400",href:h.route("player.profile",e.user.id)},{default:x(()=>[q("@"+b(e.user.username),1)]),_:1},8,["href"]),t("div",gt,[r(D,{start:e.media[0].created_at,format:"DD/MM/YYYY hh:mm a"},null,8,["start"])])])]),t("div",vt,[h.route().current("chats.show")?(a(),l("a",{key:0,href:v.value,download:c.value},[r(s(Ze),{class:"w-6 text-black cursor-pointer",onClick:f[0]||(f[0]=d=>$e(g)?g.value=!0:g=!0)})],8,yt)):p("",!0),r(s(V),{class:"w-6 text-black cursor-pointer",onClick:f[1]||(f[1]=d=>h.$emit("close"))})])]),t("div",xt,[r(s(de),{dir:"ltr","onSplide:moved":S,"aria-labelledby":"thumbnail-example-heading",options:C,ref_key:"main",ref:o,"has-track":!1},{default:x(()=>[L(t("div",bt,[t("button",wt,[r(he)]),t("button",_t,[r(he)])],512),[[H,i.media.length>1]]),r(s(Be),{id:"splide01-track"},{default:x(()=>[(a(!0),l(N,null,F(e.media,d=>(a(),T(s(ce),{key:d.id,class:"w-full my-4"},{default:x(()=>[d.mime_type.startsWith("image")?(a(),l("img",{key:0,class:"object-contain h-full mx-auto rounded-lg w-[min(500px , 90%)]",src:d==null?void 0:d.original_url,alt:""},null,8,$t)):d.mime_type.startsWith("video")?(a(),l("video",{key:1,src:d.original_url,controls:"",class:"h-full max-w-full mx-auto rounded-lg w-[min(500px , 90%)]"},null,8,kt)):p("",!0)]),_:2},1024))),128))]),_:1})]),_:1},512)]),L(t("div",Mt,[r(s(de),{dir:"ltr",options:y,ref_key:"thumbs",ref:m,class:"[&_ul]:justify-center [&_ul]:items-center"},{default:x(()=>[(a(!0),l(N,null,F(e.media,d=>(a(),T(s(ce),{key:d.id,class:"",style:{border:"none !important"}},{default:x(()=>[d.mime_type.startsWith("image")?(a(),l("img",{key:0,class:"object-contain h-full rounded-lg",src:d==null?void 0:d.original_url,alt:""},null,8,Ct)):d.mime_type.startsWith("video")?(a(),l("video",{key:1,src:d.original_url,class:"object-contain h-full rounded-lg"},null,8,jt)):p("",!0)]),_:2},1024))),128))]),_:1},512)],512),[[H,i.media.length>1]])])]),_:1},8,["show","max-width","closeable","position"]))}},fe=ee(Tt,[["__scopeId","data-v-134103e7"]]),St=["src"],Wt=["src"],Nt={key:2,class:"flex items-center justify-between gap-2"},Pt={class:"flex gap-1"},Bt={key:0,class:"object-contain w-7 h-7",src:"/images/doc.png"},Ut={key:1,class:"object-contain w-7 h-7",src:"/images/pdf.png"},Ot={class:"truncate text-start max-w-[15ch]"},Lt=["href","download"],pe={__name:"SingleMediaPreview",props:["media","isCurrentUser"],emits:["showGallery"],setup(e){return(n,i)=>{var o,m,g,v,c,C,y,S,h;return a(),l("div",{class:U([e.isCurrentUser?"text-white":"text-stone-800","w-full h-full overflow-hidden rounded-md"])},[(o=e.media)!=null&&o.mime_type.startsWith("image")?(a(),l("div",{key:0,onClick:i[0]||(i[0]=f=>n.$emit("showGallery"))},[t("img",{class:"object-contain max-w-full w-52",src:(m=e.media)==null?void 0:m.original_url,alt:""},null,8,St)])):(g=e.media)!=null&&g.mime_type.startsWith("video")?(a(),l("div",{key:1,onClick:i[1]||(i[1]=f=>n.$emit("showGallery"))},[t("video",{src:e.media.original_url,controls:"",class:"object-contain w-full h-full max-w-full"},null,8,Wt)])):((v=e.media)==null?void 0:v.mime_type.endsWith(".document"))||((c=e.media)==null?void 0:c.mime_type.startsWith("application/msword"))||((C=e.media)==null?void 0:C.mime_type.startsWith("application/pdf"))?(a(),l("div",Nt,[t("div",Pt,[((y=e.media)==null?void 0:y.mime_type.endsWith(".document"))||((S=e.media)==null?void 0:S.mime_type.startsWith("application/msword"))?(a(),l("img",Bt)):p("",!0),(h=e.media)!=null&&h.mime_type.startsWith("application/pdf")?(a(),l("img",Ut)):p("",!0),t("p",Ot,b(e.media.file_name),1)]),t("a",{href:e.media.original_url,download:e.media.file_name},[r(s(Ge),{class:"w-10 h-10 cursor-pointer"})],8,Lt)])):p("",!0)],2)}}},qt=["src"],Ft=["src"],Y={__name:"MediaThumbnails",props:["media","isCurrentUser"],setup(e){return(n,i)=>{var o,m,g;return a(),l("div",{class:U([e.isCurrentUser?"text-white":"text-stone-800","w-full overflow-hidden rounded-md aspect-square"])},[(o=e.media)!=null&&o.mime_type.startsWith("image")?(a(),l("img",{key:0,class:"object-cover w-full h-full",src:(m=e.media)==null?void 0:m.original_url,alt:""},null,8,qt)):(g=e.media)!=null&&g.mime_type.startsWith("video")?(a(),l("video",{key:1,src:e.media.original_url,class:"object-cover w-full h-full"},null,8,Ft)):p("",!0)],2)}}},zt={key:0,class:"self-start"},It={class:"max-w-[60%]"},Dt={key:0},At={key:1},Rt={class:""},Et={class:"absolute inset-0 grid font-bold text-white rounded-md cursor-pointer max-sm:text-xs bg-stone-700/70 place-items-center"},Yt={class:"absolute inset-0 grid font-bold text-white rounded-md cursor-pointer bg-stone-700/70 place-items-center max-sm:text-xs"},Vt={key:1,class:"flex flex-col gap-1 mt-2"},Ht={class:"break-all whitespace-pre-wrap"},Gt={key:0},Zt={key:1},Kt={class:"capitalize text-primary"},Qt={key:1,class:"absolute top-0 ltr:right-0 rtl:left-0"},Jt={class:"absolute z-20 px-6 py-2 text-xs text-white bg-black border -top-1 rounded-xl border-neutral-500 pie-10 z-2 rtl:left-7 ltr:right-7"},Xt={class:"flex flex-col justify-center gap-y-2"},es={class:"flex items-center justify-center gap-x-2 rtl:flex-row-reverse"},ts={class:"flex items-center justify-center gap-x-2 rtl:flex-row-reverse"},ss={__name:"ChatMessage",props:{message:Object,player:null},emits:["reply"],setup(e,{emit:n}){const i=se(),o=e;ie(()=>{setTimeout(()=>{o.message.new=!1},1e4)});const m=oe().props.auth.user,g=$(!1),v=$(!1),c=$(!1),C=$(!1),y=o.message.attachments.filter(j=>j.mime_type.startsWith("image")||j.mime_type.startsWith("video")),S=o.message.attachments.filter(j=>!j.mime_type.startsWith("image")&&!j.mime_type.startsWith("video")),h=z(()=>o.message.sender_id===m.id),f=z(()=>h.value?"self-end  ":"self-start   "),d=z(()=>h.value?"relative flex justify-end   pie-8 ":"flex gap-2 items-center  "),A=z(()=>h.value?" bg-primary text-white rounded-br-none":" bg-stone-200 text-black rounded-bl-none"),R=z(()=>h.value?"bg-white text-black  ":"bg-primary text-white  "),W=z(()=>{var j;return(j=o.message)!=null&&j.new?'border-t-2    border-green-400 relative before:content-["New"] before:absolute before:-top-3 before:bg-white before:right-3 before:text-sm before:text-green-700 before:px-1 ':""});function E(j){i.setMessageToReplyTo(o.message),g.value&&(g.value=!1)}function G(){I.delete(route("api.messages.delete",o.message.id)),g.value=!1,i.deleteMessage(o.message.id)}return(j,k)=>{const Z=ve("OnClickOutside");return a(),T(ne,{appear:""},{default:x(()=>{var K,Q;return[t("div",{class:U([[s(f),s(d),s(W)],"w-full pt-2 transition-all duration-150"])},[s(h)?p("",!0):(a(),l("div",zt,[r(te,{id:e.player.id,"image-url":e.player.avatar_url,size:"md",username:e.player.name,border:!0},null,8,["id","image-url","username"])])),t("div",It,[t("div",{class:U([[s(A)],"max-w-full p-4 rounded-2xl"])},[e.message.parent_id?(a(),l("div",{key:0,class:U([s(R),"p-3 mb-2 text-xs rounded-lg"])},[t("div",{class:U(["mb-2 font-semibold capitalize",s(h)?"text-primary":"text-white"])},[((K=e.message.parent)==null?void 0:K.sender_id)===e.player.id?(a(),l("h4",Dt,b(e.player.name),1)):(a(),l("h4",At,b(s(m).name),1))],2),t("span",Rt,b((Q=e.message.parent)==null?void 0:Q.body),1),e.message.parent.attachments[0]?(a(),T(le,{key:0,fileType:e.message.parent.attachments[0].mime_type,filePreview:e.message.parent.attachments[0].original_url,fileName:e.message.parent.attachments[0].name},null,8,["fileType","filePreview","fileName"])):p("",!0)],2)):p("",!0),e.message.attachments&&e.message.attachments.length===1?(a(),l(N,{key:1},[r(pe,{onShowGallery:k[0]||(k[0]=u=>c.value=!0),media:e.message.attachments[0],"is-current-user":s(h),class:"cursor-pointer"},null,8,["media","is-current-user"]),r(fe,{show:s(c),onClose:k[1]||(k[1]=u=>c.value=!1),media:e.message.attachments,user:e.message.message_sender},null,8,["show","media","user"])],64)):p("",!0),e.message.attachments.length>1?(a(),l(N,{key:2},[s(y).length?(a(),l("div",{key:0,class:U(["grid max-w-[200px] grid-cols-2 gap-2 place-items-center",s(y).length>2?"grid-rows-2":""])},[r(Y,{media:s(y)[0]},null,8,["media"]),s(y).length>2?(a(),T(Y,{key:0,media:s(y)[1]},null,8,["media"])):p("",!0),s(y).length==2?(a(),l("div",{key:1,class:"relative w-full aspect-square",onClick:k[2]||(k[2]=u=>v.value=!0)},[r(Y,{media:s(y)[1]},null,8,["media"]),t("div",Et,b(`${j.$page.props.locale=="en"?"show all":"\u0639\u0631\u0636 \u0627\u0644\u062C\u0645\u064A\u0639"}`),1)])):p("",!0),s(y)[2]?(a(),T(Y,{key:2,media:s(y)[2]},null,8,["media"])):p("",!0),s(y).length>=3?(a(),l("div",{key:3,class:"relative w-full aspect-square",onClick:k[3]||(k[3]=u=>v.value=!0)},[r(Y,{media:s(y)[4]},null,8,["media"]),t("div",Yt,b(s(y).length>3?`+ ${s(y).length-3} ${j.$page.props.locale=="en"?"more...":"\u0627\u0644\u0645\u0632\u064A\u062F ..."}`:`${j.$page.props.locale=="en"?"show all":"\u0639\u0631\u0636 \u0627\u0644\u062C\u0645\u064A\u0639"}`),1)])):p("",!0)],2)):p("",!0),s(S).length?(a(),l("div",Vt,[(a(!0),l(N,null,F(s(S),(u,M)=>(a(),T(pe,{key:u.id,media:u,"is-current-user":s(h)},null,8,["media","is-current-user"]))),128))])):p("",!0),r(fe,{show:s(v),onClose:k[4]||(k[4]=u=>v.value=!1),media:s(y),user:e.message.message_sender},null,8,["show","media","user"])],64)):p("",!0),t("div",Ht,b(e.message.body),1)],2),t("div",{class:U(["mt-2 text-xs",s(h)?"text-end":null])},[s(h)?(a(),l("span",Gt,[e.message.read_at?(a(),T(D,{key:0,start:e.message.read_at,format:"hh:mm A"},null,8,["start"])):(a(),T(D,{key:1,start:e.message.created_at,format:"hh:mm A"},null,8,["start"]))])):p("",!0),s(h)?p("",!0):(a(),l("span",Zt,[r(D,{start:e.message.created_at,format:"hh:mm A"},null,8,["start"])])),s(h)?(a(),l(N,{key:2},[k[10]||(k[10]=t("span",null," | ",-1)),t("span",Kt,b(e.message.read_at?"r":"s"),1)],64)):p("",!0)],2)]),s(h)?(a(),l("div",Qt,[t("button",{onClick:k[5]||(k[5]=u=>g.value=!s(g))},[r(s(Je),{class:"w-6 text-neutral-500"})]),r(Z,{onTrigger:k[8]||(k[8]=u=>g.value=!1)},{default:x(()=>[r(ae,{enterFromClass:"opacity-0",enterToClass:"opacity-100",leaveFromClass:"opacity-100",leaveToClass:"opacity-0","leave-active-class":"transition-all duration-150 ease-in",enterActiveClass:"transition-all duration-150 ease-out"},{default:x(()=>[L(t("div",Jt,[t("ul",Xt,[t("button",{class:"hover:text-gray-400",onClick:k[7]||(k[7]=u=>C.value=!0)},[t("li",es,[r(s(Le),{class:"w-4"}),t("span",null,b(j.$t("delete")),1)]),r(Oe,{show:s(C),onClose:k[6]||(k[6]=u=>C.value=!1),onDelete:G},{body:x(()=>[t("span",null,b(j.$t("Are you sure you want delete this message ? ")),1)]),_:1},8,["show"])]),t("button",{class:"hover:text-gray-400 group",onClick:E},[t("li",ts,[r(me,{class:"cursor-pointer fill-transparent group-hover:stroke-gray-400 stroke-white rtl:mis-2"}),t("span",null,b(j.$t("Quote")),1)])])])],512),[[H,s(g)]])]),_:1})]),_:1})])):p("",!0),s(h)?p("",!0):(a(),l("button",{key:2,onClick:k[9]||(k[9]=u=>s(i).setMessageToReplyTo(e.message))},[r(me,{class:"fill-transparent hover:fill-black stroke-black"})]))],2)]}),_:1})}}},as={},ls={class:"flex justify-center items-center bg-gray-50"},rs={class:"text-xs text-gray-500"};function is(e,n){return a(),l("div",ls,[t("p",rs,[ke(e.$slots,"default")])])}const ge=ee(as,[["render",is]]),os={class:"flex justify-center gap-1 text-xs font-bold"},ns={__name:"ChatMessagesContainer",props:{conversation:{required:!0,type:Object},player:{required:!0,type:Object}},setup(e){const n=e,i=se(),o=$(null);function m(v){return v.reduce((c,C)=>{const y=ye(C.created_at).format("DD MMMM YYYY");return c[y]?c[y].push(C):c[y]=[C],c},{})}const g=Me(()=>m([...i.messageList].reverse()));return ie(()=>{const v=oe().props.auth.user;i.initialize({conversation:n.conversation,container:o.value,currentUserId:v.id})}),Ce(()=>{i.unRegisterScrollListener(),i.clearFetchNewMessages(),i.UnsubscribeFromChatChannel()}),(v,c)=>{const C=re;return L((a(),l("div",{ref_key:"messagesContainer",ref:o,class:"relative overscroll-contain flex flex-col gap-y-4 overflow-auto p-2 min-h-[300px] max-h-[350px] hideScrollBar md:min-h-[400px] md:max-h-[450px]"},[s(i).showLastPageNotice?(a(),T(ge,{key:0},{default:x(()=>c[0]||(c[0]=[q("No more messages to load.")])),_:1})):p("",!0),s(i).isLoading?(a(),T(ge,{key:1},{default:x(()=>c[1]||(c[1]=[q("Loading.")])),_:1})):p("",!0),(a(!0),l(N,null,F(g.value,(y,S)=>(a(),l(N,{key:S},[t("div",os,[r(D,{start:S,format:"DD MMMM YYYY"},null,8,["start"])]),(a(!0),l(N,null,F([...y],h=>(a(),T(ss,{key:h.id,message:h,player:e.player},null,8,["message","player"]))),128))],64))),128))])),[[C,s(i).isLoading]])}}},ds={key:0,class:"w-full"},cs={class:"flex items-center justify-between gap-4 p-4"},us={class:"grow"},ms={class:"flex-none"},hs={key:1,class:"flex w-full"},fs={class:"flex items-center flex-1 gap-4 p-4 ltr:border-r ltr:border-r-stone-400 rtl:border-l rtl:border-l-stone-400"},ps={class:"flex flex-col"},gs={class:"text-xs mt-1"},vs={class:"flex items-center gap-4 p-4"},ys={__name:"ChatHeader",props:{conversation:{required:!0,type:Object},player:{required:!0,type:Object}},setup(e){const n=se(),i=$(!1);function o(){i.value=!1,n.search="",n.messages=[],n.fetchMessages()}const m=_.debounce(n.searchMessages,500);return je(()=>n.search,()=>{m()}),(g,v)=>(a(),T(ne,null,{default:x(()=>[i.value?(a(),l("div",ds,[t("div",cs,[t("div",us,[r(ze,{type:"search",modelValue:s(n).search,"onUpdate:modelValue":v[0]||(v[0]=c=>s(n).search=c),placeholder:g.$t("Search")},null,8,["modelValue","placeholder"])]),t("div",ms,[t("button",{onClick:o,class:"p-1 rounded-full group hover:ring-primary hover:ring"},[r(s(V),{class:"w-5 text-black group-hover:text-primary"})])])])])):(a(),l("div",hs,[t("div",fs,[r(te,{"image-url":e.player.avatar_url,id:e.player.id,username:e.player.name,size:"md",border:!0,"border-color":"primary"},null,8,["image-url","id","username"]),t("div",ps,[r(s(X),{class:"mb-1 font-bold leading-none capitalize text-primary",href:g.route("player.profile",e.player.id)},{default:x(()=>[q(b(e.player.name),1)]),_:1},8,["href"]),r(s(X),{class:"text-xs leading-none text-neutral-500",href:g.route("player.profile",e.player.id)},{default:x(()=>[q(" @"+b(e.player.username),1)]),_:1},8,["href"]),t("div",gs,[r(D,{end:e.player.last_seen_at,type:"period"},null,8,["end"])])])]),t("div",vs,[t("button",{onClick:v[1]||(v[1]=c=>i.value=!0)},[r(s(Ie),{class:"w-5 h-5 cursor-pointer text-primary hover:text-primaryDark"})]),r(qe,{"reportable-id":e.conversation.id,"reportable-type":"App\\Models\\Conversation"},{trigger:x(()=>[t("button",null,[r(s(Fe),{class:"h-5 w-5 text-red-500 mt-0.5"})])]),_:1},8,["reportable-id"])])]))]),_:1}))}},xs={class:"flex min-h-[500px] flex-col justify-between p-6 pt-0"},bs={class:"flex justify-center"},ws={class:"text-xl font-bold uppercase text-primary"},_s={class:"flex flex-col items-center h-full gap-2 py-8"},$s={class:"w-full max-w-[300px] sm:px-20"},ks={class:"flex items-center justify-center mb-6"},Ms=["disabled"],Cs={class:"relative overflow-auto hideScrollBar max-h-80"},js={class:"relative grid grid-cols-3 gap-2"},Ts={key:0,class:"relative"},Ss=["src","onClick"],Ws=["src"],Ns=["onClick"],Ps={class:"flex flex-col items-start justify-center h-full p-1 opacity-100"},Bs=["onClick"],Us={class:"flex flex-col items-start justify-center h-full p-1 opacity-100"},Os={key:1,class:"relative flex flex-col gap-4"},Ls={class:"text-xs text-center text-gray-400 truncate"},qs=["onClick"],Fs={class:"flex flex-col items-start justify-center h-full p-1 opacity-100"},zs={key:2,class:"relative flex flex-col gap-4"},Is={class:"text-xs text-center text-gray-400 truncate"},Ds=["onClick"],As={class:"flex flex-col items-start justify-center h-full p-1 opacity-100"},Rs={key:0,class:"absolute inset-0 z-20 grid w-full h-full p-4 place-content-center bg-stone-400/50"},Es={key:0,class:"mb-2 text-sm text-center text-red-500"},Ys={class:"mb-2 text-sm justify-self-end text-primary"},Vs={__name:"UploadChatFile",props:{modelValue:{required:!1,default:null},shouldUpload:{require:!1,type:Boolean,default:!1},currentImageUrl:{required:!1,type:String,default:null},modelName:{required:!1,type:String},modelId:{required:!1,type:Number},collectionName:{required:!1,type:String},show:{type:Boolean,default:!1},maxWidth:{type:String,default:"lg"},closeable:{type:Boolean,default:!0},position:{required:!1,type:String,default:"center"}},emits:["close","update:modelValue","reload","upload"],setup(e,{emit:n}){const i=n,o=$(!1),m=$([]),g=$(null),v=$(!1),c=$(!1),C=$(0),y=$(!1),S=$(null),h=$([]),f=$(!1),d=$(oe().props.maximumUploadNumberOfFiles),A=u=>{S.value=u,y.value=!0};function R(){y.value=!1}const W=()=>{g.value.value=null,g.value.click()},E=()=>{if(!g.value.files.length)return;let u=Array.from(g.value.files).map(M=>({file:M,id:_.uniqueId("f")}));u=G(u),u==null||u.forEach(({file:M,id:B},w)=>{const O=URL.createObjectURL(M);m.value.push({file:M,url:O,name:M.name,type:M.type,id:B}),o.value=!0})};function G(u){if(u.length+m.value.length>d.value){let B=d.value-m.value.length;if(B<=0)return;if(B)return u=u.slice(0,B)}return u}const j=u=>{h.value.id,m.value[u].id&&(h.value={},f.value=!1),m.value.splice(u,1),m.value.length===0&&(o.value=!1)},k=()=>{if(!m.value.length)return;v.value=!0,c.value=!0;let u=m.value.map(M=>M.file);i("upload",u,m.value),Z()};function Z(u){m.value=[],v.value=!1,c.value=!1,C.value+=1,i("close")}let K=u=>{h.value=u,f.value=!0};function Q(u,M,B){let w=m.value.findIndex(O=>O.id===B);m.value[w].url=M,m.value[w].file=u,h.value=[]}return(u,M)=>{const B=re;return a(),T(xe,{show:e.show,"max-width":e.maxWidth,closeable:e.closeable,position:e.position,onClose:Z,key:C.value},{default:x(()=>[t("div",xs,[t("div",bs,[t("h2",ws,b(u.$t("upload")),1)]),t("div",_s,[t("div",$s,[t("input",{ref_key:"photoInput",ref:g,type:"file",multiple:"",accept:"image/*,video/*,.pdf,.doc,.docx",class:"hidden",onChange:E},null,544),t("div",ks,[t("button",{type:"button",disabled:c.value,class:"inline-flex items-center p-4 text-white bg-black border border-transparent rounded-full shadow-sm enabled: enabled:hover:bg-black enabled:focus:outline-none enabled:focus:ring-2 enabled:focus:ring-black enabled:focus:ring-offset-2 disabled:bg-stone-500",onClick:P(W,["prevent"])},[r(s(Ee),{class:"w-5 h-5"})],8,Ms)])]),L((a(),l("div",Cs,[t("div",js,[(a(!0),l(N,null,F(m.value,(w,O)=>(a(),l(N,{key:O},[w.url.startsWith("data:image")||w.type.startsWith("image")||w.url.startsWith("data:video")||w.type.startsWith("video")?(a(),l("div",Ts,[w.url.startsWith("data:image")||w.type.startsWith("image")?(a(),l("img",{key:0,src:w.url,alt:"",class:"object-contain w-full h-full rounded-lg aspect-square",onClick:P(J=>A(w.url),["stop"])},null,8,Ss)):p("",!0),w.url.startsWith("data:video")||w.type.startsWith("video")?(a(),l("video",{key:1,src:w.url,alt:"",class:"object-cover w-full h-full rounded-lg aspect-square"},null,8,Ws)):p("",!0),t("button",{onClick:P(J=>j(O),["prevent","stop"]),class:"absolute top-0 right-0 bg-white rounded-bl-xl bg-opacity-90"},[t("div",Ps,[r(s(V),{class:"w-5 h-5 text-stone-800"})])],8,Ns),w.url.startsWith("data:image")||w.type.startsWith("image")?(a(),l("button",{key:2,class:"absolute top-0 left-0 bg-white rounded-br-xl bg-opacity-90",onClick:P(J=>s(K)(w),["stop"])},[t("div",Us,[r(Ae,{class:"w-4"})])],8,Bs)):p("",!0)])):w.url.startsWith("data:application/pdf")||w.type.startsWith("application/pdf")?(a(),l("div",Os,[M[2]||(M[2]=t("img",{class:"mx-auto h-36",src:"/images/pdf.png"},null,-1)),t("p",Ls,b(w.name),1),t("button",{onClick:P(J=>j(O),["prevent"]),class:"absolute top-0 right-0 bg-white rounded-bl-xl bg-opacity-90"},[t("div",Fs,[r(s(V),{class:"w-5 h-5 text-stone-800"})])],8,qs)])):w.type.endsWith(".document")||w.type.startsWith("application/msword")?(a(),l("div",zs,[M[3]||(M[3]=t("img",{class:"mx-auto h-36",src:"/images/doc.png"},null,-1)),t("p",Is,b(w.name),1),t("button",{onClick:P(J=>j(O),["prevent"]),class:"absolute top-0 right-0 bg-white rounded-bl-xl bg-opacity-90"},[t("div",As,[r(s(V),{class:"w-5 h-5 text-stone-800"})])],8,Ds)])):p("",!0)],64))),128)),r(ne,null,{default:x(()=>[v.value?(a(),l("div",Rs)):p("",!0)]),_:1})])])),[[H,o.value],[B,v.value]])]),t("div",null,[r(Re,{img:h.value,onCrop:Q,open:f.value,"onUpdate:open":[M[0]||(M[0]=w=>f.value=w),M[1]||(M[1]=()=>f.value=!1)]},null,8,["img","open"]),m.value.length>=d.value?(a(),l("div",Es,b(u.$t("the maximum allowed file is :maximumUploadNumberOfFiles",{maximumUploadNumberOfFiles:d.value})),1)):p("",!0),t("div",Ys,b(u.$t("video, images, PDFs and docs are allowed with max size(84 MB) are allowed")),1),r(De,{onClick:P(k,["prevent"]),disabled:c.value},{default:x(()=>[q(b(u.$t("upload")),1)]),_:1},8,["disabled"])])]),(a(),T(Te,{to:"body"},[r(s(Ue),{visible:y.value,imgs:S.value,onHide:R},null,8,["visible","imgs"])]))]),_:1},8,["show","max-width","closeable","position"])}}},Hs={class:"grid p-6 bg-white gap-y-4 rounded-2xl"},Gs={key:0,class:"relative flex flex-row items-center justify-between w-full px-2 py-2 text-sm bg-gray-100 group rounded-xl"},Zs={key:0,class:"flex items-center justify-start space-x-4"},Ks={class:"font-bold capitalize text-primary pis-3"},Qs={class:"max-w-[70ch] truncate"},Js={class:"text-black max-w-[15rem]"},Xs={key:0},ea={class:"flex flex-col items-start justify-center h-full p-1 opacity-100"},ta={key:0,class:"grid grid-cols-4 gap-2 ml-auto overflow-hidden overflow-y-auto max-h-32 hideScrollBar place-items-center"},sa={class:"relative w-full"},aa=["onClick"],la={class:"flex flex-col items-start justify-center h-full p-1 opacity-100"},ra={class:"flex flex-row items-center w-full gap-x-3"},ia={class:"relative flex items-center"},oa={class:"absolute z-20 bottom-full ltr:left-full rtl:right-full"},na={class:"flex items-center flex-grow p-1 rounded-full bg-stone-100"},da=["onKeypress","placeholder"],ca={class:"absolute bottom-0 rounded-full bg-white -right-[1px]"},ua=["disabled"],ma={__name:"ChatForm",props:{conversation:{required:!0,type:Object},player:{required:!0,type:Object}},setup(e){const n=e,i=$(!1),o=se(),m=$(!1),g=$(!1),v=$(null),c=Se({parent_id:null,body:"",attachments:null}),C=()=>{m.value||c.body===""&&!c.attachments.length||(m.value=!0,o.repliedMessage&&(c.parent_id=o.repliedMessage.id),I.post(route("api.messages.store",n.conversation.id),c.data(),{headers:{"Content-Type":"multipart/form-data"}}).then(f=>{o.pushNewMessage(f.data.data)}).catch(f=>{console.error(f)}).finally(()=>{m.value=!1,c.reset(),v.value=[]}))};function y(f,d){c.attachments?(c.attachments=[...c.attachments,...f],v.value=[...v.value,...d]):(c.attachments=f,v.value=d)}const S=f=>{v.value.splice(f,1),c.attachments.splice(f,1)};function h(f){c.body+=f}return(f,d)=>{const A=ve("OnClickOutside"),R=re;return a(),l("div",Hs,[r(ae,{"enter-from-class":"opacity-0","enter-to-class":"opacity-100","enter-active-class":"transition-all duration-150 ease-out","leave-active-class":"transition-all duration-150 ease-in","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:x(()=>[s(o).repliedMessage?(a(),l("div",Gs,[s(o).repliedMessage?(a(),l("div",Zs,[r(te,{id:s(o).repliedMessage.message_sender.id,"image-url":s(o).repliedMessage.message_sender.avatar_url,username:s(o).repliedMessage.message_sender.name,border:!0,"border-color":"primary",size:"sm"},null,8,["id","image-url","username"]),t("div",Ks,[t("div",null,b(s(o).repliedMessage.sender_id===f.$page.props.auth.user.id?f.$page.props.auth.user.name:e.player.name),1),r(s(X),{class:"text-xs font-normal text-gray-600",href:f.route("player.profile",s(o).repliedMessage.message_sender.id)},{default:x(()=>[q("@"+b(s(o).repliedMessage.message_sender.username),1)]),_:1},8,["href"])]),t("div",Qs,b(s(o).repliedMessage.body),1)])):p("",!0),t("div",null,[t("div",Js,[s(o).repliedMessage.attachments.length?(a(),l("div",Xs,[r(le,{fileType:s(o).repliedMessage.attachments[0].mime_type,filePreview:s(o).repliedMessage.attachments[0].original_url,fileName:s(o).repliedMessage.attachments[0].file_name},null,8,["fileType","filePreview","fileName"])])):p("",!0)])]),t("button",{onClick:d[0]||(d[0]=P(W=>s(o).setMessageToReplyTo(null),["prevent"])),class:"absolute top-0 left-0 hidden bg-white group-hover:block bg-opacity-90 rounded-br-xl"},[t("div",ea,[r(s(ue),{class:"w-5 h-5 text-stone-800"})])])])):p("",!0)]),_:1}),r(ae,{"enter-from-class":"opacity-0","enter-to-class":"opacity-100","enter-active-class":"transition-all duration-150 ease-out","leave-active-class":"transition-all duration-150 ease-in","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:x(()=>[L((a(),l("div",null,[v.value?(a(),l("div",ta,[(a(!0),l(N,null,F(v.value,(W,E)=>(a(),l("div",sa,[r(le,{fileType:W.type,filePreview:W.url,fileName:W.name},null,8,["fileType","filePreview","fileName"]),t("button",{onClick:P(G=>S(E),["prevent"]),class:"absolute top-0 right-0 bg-white bg-opacity-90 rounded-bl-xl"},[t("div",la,[r(s(ue),{class:"w-5 h-5 text-stone-800"})])],8,aa)]))),256))])):p("",!0)])),[[R,m.value]])]),_:1}),t("div",ra,[r(A,{class:"hidden sm:block",onTrigger:d[2]||(d[2]=W=>i.value=!1)},{default:x(()=>[t("div",ia,[t("button",{onClick:d[1]||(d[1]=W=>i.value=!i.value),"data-cancel-blur":!0},[r(s(Ye),{class:"w-6 text-neutral-400"})]),L(t("div",oa,[r(Ve,{onSelectedEmoji:h})],512),[[H,i.value]])])]),_:1}),t("div",na,[L(t("textarea",{"onUpdate:modelValue":d[3]||(d[3]=W=>s(c).body=W),onKeypress:Ne(P(C,["exact","prevent"]),["enter"]),name:"body",id:"body",rows:"1",placeholder:f.$t("Type your Message Here"),class:"w-full p-2 px-4 border-none rounded-full resize-none max-sm:placeholder:text-xs focus:ring-primary bg-stone-100 placeholder:text-neutral-400 text-stone-700 hideScrollBar"},null,40,da),[[We,s(c).body]])]),t("button",{class:"relative",onClick:d[5]||(d[5]=W=>g.value=!0)},[r(s(Qe),{class:"w-6 h-6 text-neutral-400"}),t("span",ca,[r(Vs,{show:g.value,onClose:d[4]||(d[4]=W=>g.value=!1),onUpload:y},null,8,["show"]),r(s(Ke),{class:"w-2 h-2 text-neutral-400"})])]),t("button",{disabled:m.value,class:"p-1 group",onClick:C},[r(s(He),{class:U(["w-5 rtl:rotate-180",m.value?"text-neutral-400":"text-neutral-900"])},null,8,["class"])],8,ua)])])}}},Va={__name:"Show",props:{conversation:null,conversations:null,player:null},setup(e){return Pe("conversation",e.conversation),(i,o)=>(a(),T(be,{title:"Chat"},{header:x(()=>[q(b(i.$t("chat")),1)]),default:x(()=>[r(we,{conversations:e.conversations},{header:x(()=>[r(ys,{conversation:e.conversation,player:e.player},null,8,["conversation","player"])]),main:x(()=>[r(ns,{conversation:e.conversation,player:e.player},null,8,["conversation","player"])]),footer:x(()=>[r(ma,{conversation:e.conversation,player:e.player},null,8,["conversation","player"])]),_:1},8,["conversations"])]),_:1}))}};export{Va as default};
